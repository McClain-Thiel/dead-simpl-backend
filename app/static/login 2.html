<!DOCTYPE html>
<html>
<head>
    <title>Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script>
        fetch("/docs/config")
            .then(response => response.json())
            .then(firebaseConfig => {
                // Initialize Firebase
                const app = firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth();

                window.login = function() {
                    const email = document.getElementById("email").value;
                    const password = document.getElementById("password").value;

                    auth.signInWithEmailAndPassword(email, password)
                        .then((userCredential) => {
                            // Signed in 
                            const user = userCredential.user;
                            user.getIdToken().then((idToken) => {
                                // Send the ID token to the server
                                fetch("/docs", {
                                    method: "GET",
                                    headers: {
                                        "Authorization": "Bearer " + idToken
                                    }
                                }).then((response) => {
                                    if (response.ok) {
                                        window.location.href = "/docs";
                                    } else {
                                        alert("You are not authorized to view this page.");
                                    }
                                });
                            });
                        })
                        .catch((error) => {
                            const errorCode = error.code;
                            const errorMessage = error.message;
                            alert(errorMessage);
                        });
                }
            });
    </script>
</head>
<body>
    <h1>Login</h1>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
</body>
</html>