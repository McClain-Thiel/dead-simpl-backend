# Environment Setup Guide\n\nThis guide will help you set up local, staging, and production environments for the AI Pocket backend.\n\n## Prerequisites\n\n- Python 3.11+\n- [uv](https://docs.astral.sh/uv/) package manager\n- Docker (for local development database)\n- Supabase account and project\n\n## Environment Overview\n\n| Environment | Database | Auth | Hot Reload | Use Case |\n|-------------|----------|------|------------|----------|\n| **Local** | Local PostgreSQL (Docker) | Supabase | ✅ | Development |\n| **Staging** | Supabase Staging DB | Supabase | ❌ | Testing |\n| **Production** | Supabase Production DB | Supabase | ❌ | Live app |\n\n## Setup Instructions\n\n### 1. Install Dependencies\n\n```bash\n# Install uv if not already installed\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Install project dependencies\nmake install\n# or: uv sync\n```\n\n### 2. Configure Supabase\n\n1. Create a Supabase project at [supabase.com](https://supabase.com)\n2. In your Supabase dashboard:\n   - Go to Settings → API\n   - Copy your **Project URL** and **anon public key**\n   - Go to Settings → Database\n   - Copy your **Connection string** (use the \"URI\" format)\n\n3. **For staging**: Create a second database in the same Supabase project or create a separate staging project\n\n### 3. Environment Configuration\n\n#### Local Development\n\n```bash\n# Copy and configure local environment\ncp .env.example .env.local\n\n# Edit .env.local with your Supabase credentials:\n# SUPABASE_URL=https://your-project.supabase.co\n# SUPABASE_KEY=your-anon-key\n```\n\n#### Staging\n\n```bash\n# Copy and configure staging environment\ncp .env.example .env.staging\n\n# Edit .env.staging with:\n# - Your Supabase credentials\n# - Staging database connection string\n```\n\n#### Production\n\n```bash\n# Copy and configure production environment\ncp .env.example .env.production\n\n# Edit .env.production with:\n# - Your Supabase credentials\n# - Production database connection string\n```\n\n## Running the Application\n\n### Local Development (Recommended)\n\n```bash\n# Start everything (database + app with hot reload)\nmake dev\n```\n\nThis will:\n1. Start a local PostgreSQL database in Docker\n2. Run database migrations automatically\n3. Start the FastAPI server with hot reload\n4. Open API docs at http://127.0.0.1:8000/docs\n\n### Alternative: Manual Local Setup\n\n```bash\n# 1. Start only the database\nmake docker-dev\n\n# 2. Run migrations\nmake migrate\n\n# 3. Start the app manually\ncp .env.local .env\nuv run uvicorn app.main:app --reload --reload-dir app\n```\n\n### Staging\n\n```bash\nmake staging\n```\n\n### Production\n\n```bash\nmake prod\n```\n\n### Full Docker Stack\n\n```bash\n# Run everything in Docker (app + database)\nmake docker-full\n```\n\n## Database Management\n\n### Migrations\n\n```bash\n# Create a new migration after model changes\nmake migrate-create MESSAGE=\"Add new table\"\n\n# Apply migrations\nmake migrate\n\n# Reset local database (⚠️ deletes all data!)\nmake reset-db\n```\n\n### Manual Database Operations\n\n```bash\n# Connect to local database\ndocker exec -it aipocket_postgres_dev psql -U postgres -d aipocket_local\n\n# View logs\nmake logs-db\n```\n\n## Troubleshooting\n\n### Database Connection Issues\n\n1. **Local development**: Ensure PostgreSQL container is running:\n   ```bash\n   docker ps | grep postgres\n   ```\n\n2. **Staging/Production**: Verify Supabase connection strings in your `.env.*` files\n\n### Migration Issues\n\n1. **Reset local database**:\n   ```bash\n   make reset-db\n   ```\n\n2. **Manual migration**:\n   ```bash\n   uv run alembic upgrade head\n   ```\n\n### Port Conflicts\n\nIf port 5432 is already in use:\n1. Stop the conflicting service\n2. Or modify the port in `docker-compose.dev.yml` and update `.env.local`\n\n## Development Workflow\n\n1. **Start development**: `make dev`\n2. **Make code changes**: Files auto-reload\n3. **Database changes**: \n   - Modify `app/db/models.py`\n   - Run `make migrate-create MESSAGE=\"your change\"`\n   - Run `make migrate`\n4. **Test**: Access http://127.0.0.1:8000/docs\n\n## Deployment\n\n### Staging Deployment\n\n1. Configure `.env.staging` with staging database\n2. Deploy using your preferred method (Docker, cloud platform, etc.)\n3. Ensure environment variables are set correctly\n\n### Production Deployment\n\n1. Configure `.env.production` with production database\n2. Use the existing `Dockerfile` and deployment scripts\n3. Ensure proper security configurations\n\n## Security Notes\n\n- Never commit `.env.*` files (except `.env.example`)\n- Use strong passwords for production databases\n- Rotate Supabase keys regularly\n- Use environment-specific Supabase projects for better isolation